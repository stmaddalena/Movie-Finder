<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Entertainment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="stylesheets/add.css">

</head>
<body>
    <form id="entertainment-form">
        <div class="box-one">
            <div class="type">
                <select id="type" name="type" required onchange="updateColor('type')" onblur="keepColor('type')">
                    <option value="" disabled selected>Type</option>
                    <option value="Movie">Movie</option>
                    <option value="Series">Series</option>
                </select>
                <div class="icon"></div>
            </div>

            <div class="title">
                <input type="text" id="title" name="title" placeholder="Title" required oninput="updateColor('title')" onblur="keepColor('title')">
            </div>
        </div>
        <div class="poster">
            <input type="text" id="poster" name="poster" placeholder="Poster Image URL" required oninput="updateColor('poster')" onblur="keepColor('poster')">
        </div>
        <div class="genres">
            <div class="genre-buttons" required>
                <button type="button" class="genre-btn" value="Action">Action</button>
                <button type="button" class="genre-btn" value="Adventure">Adventure</button>
                <button type="button" class="genre-btn" value="Animation">Animation</button>
                <button type="button" class="genre-btn" value="Biography">Biography</button>
                <button type="button" class="genre-btn" value="Comedy">Comedy</button>
                <button type="button" class="genre-btn" value="Crime">Crime</button>
                <button type="button" class="genre-btn" value="Drama">Drama</button>
                <button type="button" class="genre-btn" value="Fantasy">Fantasy</button>
                <button type="button" class="genre-btn" value="History">History</button>
                <button type="button" class="genre-btn" value="Horror">Horror</button>
                <button type="button" class="genre-btn" value="Musical">Musical</button>
                <button type="button" class="genre-btn" value="Romance">Romance</button>
                <button type="button" class="genre-btn" value="Sci-Fi">Sci-Fi</button>
                <button type="button" class="genre-btn" value="Sport">Sport</button>
                <button type="button" class="genre-btn" value="Thriller">Thriller</button>
                <button type="button" class="genre-btn" value="War">War</button>
            </div>
        </div>

        <div class="synopsis">
            <input type="text" id="synopsis" name="synopsis" placeholder="Synopsis" required oninput="updateColor('synopsis')" onblur="keepColor('synopsis')">
        </div>

        <div class="box-two">
            <div class="rating">
                <select id="rating" name="rating" required onchange="updateColor('rating')"
                    onblur="keepColor('rating')">
                    <option value="" disabled selected>Rating</option>
                    <option value="G">G</option>
                    <option value="PG">PG</option>
                    <option value="PG-13">PG-13</option>
                    <option value="R">R</option>
                    <option value="NC-17">NC-17</option>
                    <option value="TV-Y">TV-Y</option>
                    <option value="TV-Y7">TV-Y7</option>
                    <option value="TV-Y7 FV">TV-Y7 FV</option>
                    <option value="TV-G">TV-G</option>
                    <option value="TV-PG">TV-PG</option>
                    <option value="TV-14">TV-14</option>
                    <option value="TV-MA">TV-MA</option>
                </select>
                <div class="icon"></div>
            </div>


            <div class="score">
                <input type="text" id="score" name="score" required placeholder="Score" oninput="validScore(),updateColor('score')" onblur="keepColor('score')">
            </div>
            </div>

            <div class="duration">
                <input type="text" id="hours" name="hours" placeholder="Hours" required oninput="validHours(this),updateColor('hours')" onblur="keepColor('hours')"">
                <input type="text" id="minutes" name="minutes" placeholder="Minutes"required oninput="validMinutes(this),updateColor('minutes')" onblur="keepColor('minutes')"">
            </div>
       
            <div class="box-three">
                <div class="productionCos">
                    <input type="text" id="productionCos" name="productionCos" required placeholder="Production Companies" oninput="updateColor('productionCos')" onblur="keepColor('productionCos')">
                </div>  
                <div class="originalLanguage">
                    <input type="text" id="originalLanguage" name="originalLanguage" required placeholder="Original Language" oninput="updateColor('originalLanguage')" onblur="keepColor('originalLanguage')">
                </div>
            </div>

                <div class="streaming">
                    <div class="streaming-buttons">
                        <button type="button" class="streaming-btn" value="Apple TV">Apple TV</button>
                        <button type="button" class="streaming-btn" value="HBO GO">HBO GO</button>
                        <button type="button" class="streaming-btn" value="Hotstar">Hotstar</button>
                        <button type="button" class="streaming-btn" value="Crunchyroll">Crunchyroll</button>
                        <button type="button" class="streaming-btn" value="Netflix">Netflix</button>
                        <button type="button" class="streaming-btn" value="Prime Video">Prime Video</button>
                        <button type="button" class="streaming-btn" value="Viu">Viu</button>
                    </div>
                </div>

                <div class="releaseDate">
                    <div class="dropdown-container">
                        <select id="year" name="year" required onchange="updateDays(); updateColor('year')"
                            onblur="keepColor('year')">
                            <option value="" disabled selected>Year</option>
                            <script>
                                const currentYear = new Date().getFullYear();
                                const yearOptions = Array.from({ length: currentYear - 1990 + 1 }, (_, i) => {
                                    const year = 1990 + i;
                                    return `<option value="${year}">${year}</option>`;
                                }).join('');
                                document.getElementById('year').innerHTML += yearOptions;
                            </script>
                        </select>
                        <div class="icon"></div>
                    </div>

                    <div class="dropdown-container">
                        <select id="month" name="month" required onchange="updateDays(); updateColor('month')"
                            onblur="keepColor('month')">
                            <option value="" disabled selected>Month</option>
                            <option value="Jan">Jan</option>
                            <option value="Feb">Feb</option>
                            <option value="Mar">Mar</option>
                            <option value="Apr">Apr</option>
                            <option value="May">May</option>
                            <option value="Jun">Jun</option>
                            <option value="Jul">Jul</option>
                            <option value="Aug">Aug</option>
                            <option value="Sep">Sep</option>
                            <option value="Oct">Oct</option>
                            <option value="Nov">Nov</option>
                            <option value="Dec">Dec</option>
                        </select>
                        <div class="icon"></div>
                    </div>

                    <div class="dropdown-container">
                        <select id="day" name="day" required onchange="updateColor('day')" onblur="keepColor('day')">
                            <option value="" disabled selected>Day</option>
                        </select>
                        <div class="icon"></div>
                    </div>
                </div>

        <div class="cast">      
            <div id="cast-container">
                <div class="cast-item">
                    <input type="text" class="cast-name" id="cast-name" placeholder="Actor's Name" required oninput="updateColor('cast-name')" onblur="keepColor('cast-name')">
                    <input type="url" class="cast-photo" id="cast-photo" placeholder="Image URL" required oninput="updateColor('cast-photo')" onblur="keepColor('cast-photo')">
                    <button type="button" id="add-cast-btn">Cast</button>
                </div>
            </div>
        </div>

        <div class="director">
            <div id="director-container">
                <div class="director-item">
                    <input type="text" class="director-name" id="director-name" placeholder="Director's Name"  required oninput="updateColor('director-name')" onblur="keepColor('director-name')">
                    <input type="url" class="director-photo" id="director-photo" placeholder="Image URL" required oninput="updateColor('director-photo')" onblur="keepColor('director-photo')">
                    <button type="button" id="add-director-btn">Director</button>
                </div>
            </div>
        </div>

        <div class="reviews">
            <div id="reviews-container">
                <div class="reviews-item">
                    <div class="review-box-one">
                    <input type="text" class="name"  id="name" placeholder="Reviewer's Name" required oninput="updateColor('name')" onblur="keepColor('name')">
                    <div class="dropdown-container-two">
                        <select id="stars" name="stars" class="stars" onchange="updateColor('stars')" onblur="keepColor('stars')">
                            <option value="">stars</option>
                            <option value="★★★★★">★★★★★</option>
                            <option value="★★★★">★★★★</option>
                            <option value="★★★">★★★</option>
                            <option value="★★">★★</option>
                            <option value="★">★</option>
                        </select>
                        <div class="icon"></div>
                    </div>
                </div>
                    <input type="text" class="review" id="review" placeholder="Comment" required oninput="updateColor('review')" onblur="keepColor('review')">
                    <button type="button" id="add-reviews-btn">Review</button>
            </div>
        </div>
  
        </div>
        <div class="submit">
            <button type="submit">Submit</button>

        </div>
    </form>

    <script>
        function updateColor(selectId) {
            const select = document.getElementById(selectId);
            select.style.borderColor = '#333';
            select.style.color = '#333';
        }

        function keepColor(selectId) {
            const select = document.getElementById(selectId);
            if (select.value === "") {
                select.style.color = '#999'; 
                select.style.borderColor = '#ccc';
            }
        }

        const genreButtons = document.querySelectorAll('.genre-btn');
        genreButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });
        });

        function validScore() {
            const scoreInput = document.getElementById('score');
            scoreInput.value = scoreInput.value.replace(/[^0-9.]/g, '');
            const scoreValue = parseFloat(scoreInput.value);
            if (scoreValue > 10) {
                scoreInput.value = 10;
            } else {
                const parts = scoreInput.value.split('.');
                if (parts.length > 2) {
                    scoreInput.value = parts[0] + '.' + parts.slice(1).join('');
                } else if (parts.length === 2) {
                    parts[1] = parts[1].substring(0, 1);
                    scoreInput.value = parts.join('.');
                }
            }
        }

        document.getElementById('score').addEventListener('blur', function () {
            const scoreInput = document.getElementById('score');
            if (!scoreInput.value.includes('.')) {
                scoreInput.value += '.0';
            }
            if (scoreInput.value.endsWith('.')) {
                scoreInput.value += '0';
            }
        });

        function validHours(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
        }

        function validMinutes(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            if (parseInt(input.value) > 59) {
                input.value = 59;
            }
        }

        function updateDays() {
            const month = document.getElementById('month').value;
            const year = parseInt(document.getElementById('year').value);
            const daySelect = document.getElementById('day');

            daySelect.innerHTML = `<option value="" disabled selected>Day</option>`;

            let daysInMonth;
            switch (month) {
                case 'Jan':
                case 'Mar':
                case 'May':
                case 'Jul':
                case 'Aug':
                case 'Oct':
                case 'Dec':
                    daysInMonth = 31;
                    break;
                case 'Apr':
                case 'Jun':
                case 'Sep':
                case 'Nov':
                    daysInMonth = 30;
                    break;
                case 'Feb':
                    daysInMonth = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0) ? 29 : 28;
                    break;
                default:
                    daysInMonth = 0;
                    break;
            }

            for (let i = 1; i <= daysInMonth; i++) {
                daySelect.innerHTML += `<option value="${i}">${i}</option>`;
            }
        }

        let castCount = 1
        document.getElementById('add-cast-btn').addEventListener('click', () => {
            const castContainer = document.getElementById('cast-container');
            const castItem = document.createElement('div');
            castItem.className = "cast-item";
            const nameId = `cast-name-${castCount}`;
            const photoId = `cast-photo-${castCount}`;
        
            castItem.className = 'cast-item';
            castItem.innerHTML = `
        <input type="text" class="cast-name" id="${nameId}" placeholder="Actor's Name" required oninput="updateColor('${nameId}')" onblur="keepColor('${nameId}')">
        <input type="url" class="cast-photo" id="${photoId}" placeholder="Image URL" required oninput="updateColor('${photoId}')" onblur="keepColor('${photoId}')">
                <button type="button" class="remove-cast-btn">Remove</button>
            `;
            castContainer.appendChild(castItem);
            castItem.querySelector('.remove-cast-btn').addEventListener('click', () => {
                castContainer.removeChild(castItem);
            });
            castCount++;
        });

        let directorCount = 1
        document.getElementById('add-director-btn').addEventListener('click', () => {
            const directorContainer = document.getElementById('director-container');
            const directorItem = document.createElement('div');
            directorItem.className = 'director-item';
            const nameId = `director-name-${directorCount}`;
            const photoId = `director-photo-${directorCount}`;

            directorItem.innerHTML = `
        <input type="text" class="director-name" id="${nameId}" placeholder="Director's Name" required oninput="updateColor('${nameId}')" onblur="keepColor('${nameId}')">
        <input type="url" class="director-photo" id="${photoId}" placeholder="Image URL" required oninput="updateColor('${photoId}')" onblur="keepColor('${photoId}')">
                <button type="button" class="remove-director-btn">Remove</button>
            `;
            directorContainer.appendChild(directorItem);
            directorItem.querySelector('.remove-director-btn').addEventListener('click', () => {
                directorContainer.removeChild(directorItem);
            });
            directorCount++;
        });

        const streamingButtons = document.querySelectorAll('.streaming-btn');
        streamingButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });

        });

        let reviewsCount = 1
        document.getElementById('add-reviews-btn').addEventListener('click', () => {
            const reviewsContainer = document.getElementById('reviews-container');
            const reviewsItem = document.createElement('div');
            reviewsItem.className = 'reviews-item';
            const nameId = `name-${reviewsCount}`;
            const reviewId = `review-${reviewsCount}`;
            const starsID = `stars-${reviewsCount}`;
            
            reviewsItem.innerHTML = `
                <div class="review-box-one">
                           <input type="text" class="name"  id="${nameId}" placeholder="Reviewer's Name" required oninput="updateColor('${nameId}')" onblur="keepColor('${nameId}')">
                    <div class="dropdown-container-two">
                             <select id="${starsID}" name="stars" class="stars" onchange="updateColor('${starsID}')" onblur="keepColor('${starsID}')">
                            <option value="">stars</option>
                            <option value="★★★★★">★★★★★</option>
                            <option value="★★★★">★★★★</option>
                            <option value="★★★">★★★</option>
                            <option value="★★">★★</option>
                            <option value="★">★</option>
                        </select>
                        <div class="icon"></div> 
                    </div>
                </div>
                         <input type="text" class="review" id="${reviewId}" placeholder="Comment" required oninput="updateColor('${reviewId}')" onblur="keepColor('${reviewId}')">
                
                <button type="button" class="remove-reviews-btn">Remove</button>
            `;
            reviewsContainer.appendChild(reviewsItem);
            reviewsItem.querySelector('.remove-reviews-btn').addEventListener('click', () => {
                reviewsContainer.removeChild(reviewsItem);
            });
            reviewsCount++;
        });

        document.getElementById('entertainment-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const genres = Array.from(document.querySelectorAll('.genre-btn.selected')).map(button => button.value);

            const hours = event.target.hours.value;
            const minutes = event.target.minutes.value;
            const duration = `${hours} Hours ${minutes} Minutes`;

            const month = event.target.month.value;
            const day = event.target.day.value;
            const year = event.target.year.value;
            const releaseDate = `${month} ${day}, ${year}`;

            const cast = Array.from(document.querySelectorAll('.cast-item')).map(item => ({
                name: item.querySelector('.cast-name').value,
                photo: item.querySelector('.cast-photo').value
            }));


            const directors = Array.from(document.querySelectorAll('.director-item')).map(item => ({
                name: item.querySelector('.director-name').value,
                photo: item.querySelector('.director-photo').value
            }));

            const productionCos = event.target.productionCos.value.split(',').map(company => company.trim()).filter(company => company);

            const streaming = Array.from(document.querySelectorAll('.streaming-btn.selected')).map(button => button.value);

            const reviews = Array.from(document.querySelectorAll('.reviews-item')).map(item => ({
                name: item.querySelector('.name').value,
                review: item.querySelector('.review').value,
                stars: item.querySelector('select[name="stars"]').value,
            }));

            const formData = {
                type: event.target.type.value,
                title: event.target.title.value,
                synopsis: event.target.synopsis.value,
                genres: genres,
                rating: event.target.rating.value,
                score: event.target.score.value,
                duration: duration,
                releaseDate: releaseDate,
                cast: cast,
                directors: directors,
                productionCos: productionCos,
                originalLanguage: event.target.originalLanguage.value,
                streaming: streaming,
                poster: event.target.poster.value,
                reviews: reviews
            };
            console.log('Form Data:', formData);

            try {
                const response = await fetch('http://localhost:3000/entertainment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Entertainment added successfully!');
                    console.log(result);
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while submitting the form.');
            }
        });
    </script>
</body>
</html>